/**
 * class Player
 * Created by luoxinfang on 14-1-3.
 */"use strict";define(function(e,t,n){e("jQuery"),e("jPlayer");var r=e("underscore"),i=e("class"),s=i.extend({init:function(){this.$CD=$("#cd"),this.$music=$("#music_player"),this.$player=$("#jp_container"),this.$pickupArm=$("#pickup_arm"),this.$playBtn=$(".jp-play"),this.$pauseBtn=$(".jp-pause"),this.$lyric=$("#lyric>ul"),this.$tip=$("#lyric>#tip"),this.songUrl="http://somgle-song.qiniudn.com/Shayne_Ward-Until_you.mp3",this.lyricUrl="http://somgle-lyric.qiniudn.com/Shayne_Ward-Until_you.lrc",this.lyrics=[],this.bindEvent(),this.initPlayer()},rotateCD:function(){this.$CD.toggleClass("stop-rt"),this.$pickupArm.toggleClass("pick")},initPlayer:function(){var e=this,t=this.songUrl;e.getLyrics(),e.$music.jPlayer({ready:function(){$(this).jPlayer("setMedia",{mp3:t})},timeupdate:function(t){var n=t.jPlayer,r=e.lyrics,i=Math.floor(n.status.currentTime);for(var s=0,o=r.length;s<o;s++){var u=r[s][0].split(":"),a=Math.floor(u[0])*60+Math.floor(u[1]);i==a&&(e.lineHeight*s>=e.lyricMiddle&&e.lineHeight*(o-s)>=e.lyricMiddle&&e.$lyric.css({top:-e.lineHeight*(s-Math.ceil(e.lyricMiddle/e.lineHeight))+"px"}),e.$lyric.children("li").removeClass("now").eq(s).addClass("now"))}},ended:function(){e.rotateCD()},wmode:"window"})},getLyrics:function(){var e=this;$.get(this.lyricUrl,function(t){e.showLyric(t.split("\n"))})},showLyric:function(e){var t=this,n=[];for(var r=0,i=0,s=e.length;r<s;r++){var o=e[r],u,a,f;if(o.split("]")[1]){var l=o.substring(10);t.lyrics[i]=[],t.lyrics[i].push(o.substring(1,8)),t.lyrics[i].push(l),n.push('<li class="ts2">'+l+"</li>"),i++}}n.length==0?this.$tip.html("歌词好像被我丢在路上了..."):(this.$lyric.html(n.join("")),this.lineHeight=t.$lyric.children("li").height(),this.lyricMiddle=t.$lyric.parent().height()/2-this.lineHeight*2)},bindEvent:function(){var e=this;this.$playBtn.on("click",function(){e.rotateCD()}),this.$pauseBtn.on("click",function(){e.rotateCD()})}});n.exports=s});