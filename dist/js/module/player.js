"use strict";define(function(require,a,b){require("jQuery"),require("jPlayer");var c=(require("underscore"),require("class")),d=c.extend({init:function(){this.$CD=$("#cd"),this.$music=$("#music_player"),this.$player=$("#jp_container"),this.$pickupArm=$("#pickup_arm"),this.$playBtn=$(".jp-play"),this.$pauseBtn=$(".jp-pause"),this.$lyric=$("#lyric>ul"),this.$tip=$("#lyric>#tip"),this.songUrl="http://somgle-song.qiniudn.com/Shayne_Ward-Until_you.mp3",this.lyricUrl="http://somgle-lyric.qiniudn.com/Shayne_Ward-Until_you.lrc",this.lyrics=[],this.bindEvent(),this.initPlayer()},rotateCD:function(){this.$CD.toggleClass("stop-rt"),this.$pickupArm.toggleClass("pick")},initPlayer:function(){var a=this,b=this.songUrl;a.getLyrics(),a.$music.jPlayer({ready:function(){$(this).jPlayer("setMedia",{mp3:b})},timeupdate:function(b){for(var c=b.jPlayer,d=a.lyrics,e=Math.floor(c.status.currentTime),f=0,g=d.length;g>f;f++){var h=d[f][0].split(":"),i=60*Math.floor(h[0])+Math.floor(h[1]);e==i&&(a.lineHeight*f>=a.lyricMiddle&&a.lineHeight*(g-f)>=a.lyricMiddle&&a.$lyric.css({top:-a.lineHeight*(f-Math.ceil(a.lyricMiddle/a.lineHeight))+"px"}),a.$lyric.children("li").removeClass("now").eq(f).addClass("now"))}},ended:function(){a.rotateCD()},wmode:"window"})},getLyrics:function(){var a=this;$.get(this.lyricUrl,function(b){a.showLyric(b.split("\n"))})},showLyric:function(a){for(var b=this,c=[],d=0,e=0,f=a.length;f>d;d++){var g=a[d];if(g.split("]")[1]){var h=g.substring(10);b.lyrics[e]=[],b.lyrics[e].push(g.substring(1,8)),b.lyrics[e].push(h),c.push('<li class="ts2">'+h+"</li>"),e++}}0==c.length?this.$tip.html("歌词好像被我丢在路上了..."):(this.$lyric.html(c.join("")),this.lineHeight=b.$lyric.children("li").height(),this.lyricMiddle=b.$lyric.parent().height()/2-2*this.lineHeight)},bindEvent:function(){var a=this;this.$playBtn.on("click",function(){a.rotateCD()}),this.$pauseBtn.on("click",function(){a.rotateCD()})}});b.exports=d});